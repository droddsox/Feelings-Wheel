<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Feelings Wheel - Scroll Override</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: white;
    }

    #viewport {
      width: 90vw;
      aspect-ratio: 2 / 3;
      margin: 50px auto;
      position: relative;
      background: #f8f8f8;
      overflow: visible;
    }

    #draggable {
      position: absolute;
      width: 200vw;
      height: 200vw;
      top: -100vw;
      left: -55vw;
      transform-origin: center center;
      border-radius: 50%;
      touch-action: none; /* key: block scrolling while touching this */
      user-select: none;
    }

    #draggable img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      display: block;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }
  </style>
</head>
<body>

<div id="viewport">
  <div id="draggable">
    <img src="https://raw.githubusercontent.com/droddsox/Feelings-Wheel/refs/heads/main/feelings_wheel.png" alt="Feelings Wheel" />
  </div>
</div>

<script>
(function () {
  const draggable = document.getElementById("draggable");

  let active = false;
  let angle = 0;
  let rotation = 0;
  let startAngle = 0;
  const R2D = 180 / Math.PI;
  let center = { x: 0, y: 0 };

  function getCenter(el) {
    const rect = el.getBoundingClientRect();
    return {
      x: rect.left + rect.width / 2,
      y: rect.top + rect.height / 2,
    };
  }

  function startRotate(clientX, clientY) {
    center = getCenter(draggable);
    const dx = clientX - center.x;
    const dy = clientY - center.y;
    startAngle = R2D * Math.atan2(dy, dx);
    active = true;
  }

  function moveRotate(clientX, clientY) {
    if (!active) return;
    const dx = clientX - center.x;
    const dy = clientY - center.y;
    const currentAngle = R2D * Math.atan2(dy, dx);
    rotation = currentAngle - startAngle;
    draggable.style.transform = `rotate(${angle + rotation}deg)`;
  }

  function endRotate() {
    if (!active) return;
    angle += rotation;
    active = false;
  }

  // Mouse
  draggable.addEventListener("mousedown", (e) => {
    e.preventDefault();
    startRotate(e.clientX, e.clientY);
  });

  window.addEventListener("mousemove", (e) => {
    if (active) {
      e.preventDefault();
      moveRotate(e.clientX, e.clientY);
    }
  });

  window.addEventListener("mouseup", (e) => {
    if (active) {
      e.preventDefault();
      endRotate();
    }
  });

  // Touch
  draggable.addEventListener("touchstart", (e) => {
    if (e.touches.length === 1) {
      const touch = e.touches[0];
      startRotate(touch.clientX, touch.clientY);
      e.preventDefault();
    }
  }, { passive: false });

  draggable.addEventListener("touchmove", (e) => {
    if (e.touches.length === 1) {
      const touch = e.touches[0];
      moveRotate(touch.clientX, touch.clientY);
      e.preventDefault();
    }
  }, { passive: false });

  draggable.addEventListener("touchend", (e) => {
    endRotate();
    e.preventDefault();
  }, { passive: false });
})();
</script>

</body>
</html>
